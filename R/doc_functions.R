
do.AB.analysis <- function(fname){
  # ----------------------------------------------------------------------------------------------------
  # AB specific analysis
  # ---------------------------------------------------------------------------------------------------- 
  # ----------------------------------------------------------------------------------------------------
  # load data and wrangle into tidy form 
  # ----------------------------------------------------------------------------------------------------
  
  dat <- read.csv(fname, header=TRUE)
  # ----------------------------------------------------------------------------------------------------
  # Create dataframes 
  # ----------------------------------------------------------------------------------------------------
  
  ffx.dat <- dat %>% group_by(Subj.No, Trial.Type.Name) %>%
    summarise(T1=mean(T1.Accuracy),
              T2gT1=mean(T2T1.Accuracy)) %>%
              ungroup()
  names(ffx.dat)[c(1:2)] <- c("sub", "lag")
  # ----------------------------------------------------------------------------------------------------
  # run anova
  # ----------------------------------------------------------------------------------------------------
  an <- get_anova_table(anova_test(data=ffx.dat, dv=T2gT1, wid=sub, within=lag, effect.size="pes", type=3))
  
  # ----------------------------------------------------------------------------------------------------
  # do post-hoc t - tests
  # ----------------------------------------------------------------------------------------------------
  a = c("lag_2", "lag_2", "lag_2", "lag_3", "lag_3", "lag_5")
  b = c("lag_3", "lag_5", "lag_7", "lag_5", "lag_7", "lag_7")
  ts = mapply(function(x,y) t.test(ffx.dat$T2gT1[ffx.dat$lag == x],
                                   ffx.dat$T2gT1[ffx.dat$lag == y],
                                   paired=TRUE,
                                   var.equal=FALSE), a, b)
 
  # ----------------------------------------------------------------------------------------------------
  # return
  # ----------------------------------------------------------------------------------------------------
  list(an, ts)
  
}


do.CC.analysis <- function(fname){
  
  # ----------------------------------------------------------------------------------------------------
  # load data and wrangle into tidy form 
  # ----------------------------------------------------------------------------------------------------
  
  dat <- read.csv(fname, header=TRUE)
  # ----------------------------------------------------------------------------------------------------
  # create summary dataframe for CC data
  # ----------------------------------------------------------------------------------------------------
  min.RT <- 200 # in msec
  sd.crit <- 2.5
  ffx.dat <- dat %>% mutate(Block.No = rep(c(1:12), each = 24, length(unique(dat$Subj.No)))) %>%
    group_by(Subj.No, Block.No, Trial.Type.Name) %>%
    filter(Accuracy == 1) %>%
    filter(RT.ms > min.RT) %>%
    filter(RT.ms < (mean(RT.ms) + sd.crit*sd(RT.ms))) %>%
    summarise(RT=mean(RT.ms))
  subs  <- unique(ffx.dat$Subj.No)
  names(ffx.dat) <- c("sub", "block", "type", "RT")

  # ----------------------------------------------------------------------------------------------------
  # run anova
  # ----------------------------------------------------------------------------------------------------
  an <- rstatix::get_anova_table(rstatix::anova_test(data=ffx.dat%>%ungroup(), dv=RT, wid=sub, within=c(block,type), effect.size="pes", type=3))
  
  # ----------------------------------------------------------------------------------------------------
  # do post-hoc t - tests on 1st block and 12th block
  # ----------------------------------------------------------------------------------------------------
  a = c(1, 12)
  ts = lapply(a, function(x) t.test(ffx.dat$RT[ffx.dat$block == x & ffx.dat$type == "Novel"],
                                    ffx.dat$RT[ffx.dat$block == x & ffx.dat$type == "Repeated"],
                                    paired=TRUE,
                                    var.equal=FALSE))
  
  # ----------------------------------------------------------------------------------------------------
  # return
  # ----------------------------------------------------------------------------------------------------
  list(an, ts)
  
}





